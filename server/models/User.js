// ========== ИМПОРТЫ ==========

// Импортируем Mongoose для работы с MongoDB
import mongoose from 'mongoose';

// Импортируем bcrypt для хеширования паролей
import bcrypt from 'bcryptjs';

// ======================================================


// ========== СХЕМА ПОЛЬЗОВАТЕЛЯ ==========

// Создаём схему — шаблон для документа в коллекции "users"
const userSchema = new mongoose.Schema({
  // Поле: имя пользователя
  username: {
    type: String,              // Тип данных: строка
    required: true,            // Обязательное поле
    unique: true,              // Должно быть уникальным (не может быть 2 одинаковых)
    trim: true,                // Удаляет пробелы в начале и конце
    minlength: 3               // Минимальная длина: 3 символа
  },

  // Поле: email
  email: {
    type: String,              // Тип данных: строка
    required: true,            // Обязательное поле
    unique: true,              // Должен быть уникальным
    lowercase: true,           // Автоматически приводит к нижнему регистру
    match: [                   // Валидация формата email
      /^\S+@\S+\.\S+$/,        // Регулярное выражение для проверки
      'Неверный формат email'  // Сообщение об ошибке
    ]
  },

  // Поле: пароль
  password: {
    type: String,              // Тип данных: строка
    required: true,            // Обязательное поле
    minlength: 6               // Минимальная длина: 6 символов
  }
}, {
  // Дополнительные опции схемы
  timestamps: true             // Автоматически добавляет поля createdAt и updatedAt
});

// ======================================================


// ========== МЕТОДЫ СХЕМЫ ==========

// Метод для сравнения паролей
// Используется при входе в систему
userSchema.methods.comparePassword = function(candidatePassword) {
  // bcrypt.compareSync сравнивает обычный пароль с хешированным
  // candidatePassword — пароль, который ввёл пользователь
  // this.password — хешированный пароль из базы данных
  return bcrypt.compareSync(candidatePassword, this.password);
};

// ======================================================


// ========== СОЗДАНИЕ МОДЕЛИ ==========

// Создаём модель "User" на основе схемы
// Mongoose автоматически создаст коллекцию "users" в MongoDB
const User = mongoose.model('User', userSchema);

// Экспортируем модель, чтобы использовать её в других файлах
export default User;

// ======================================================