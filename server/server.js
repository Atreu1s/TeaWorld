// ========== –ò–ú–ü–û–†–¢–´ (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫) ==========

// Express ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤
import express from 'express';

// Mongoose ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MongoDB
import mongoose from 'mongoose';

// CORS ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –æ–±—â–∞—Ç—å—Å—è —Å –±—ç–∫–µ–Ω–¥–æ–º
import cors from 'cors';

// Dotenv ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
import dotenv from 'dotenv';

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–æ—É—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
import authRoutes from './routes/auth.js';

// ======================================================


// ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å process.env.PORT, process.env.MONGODB_URI –∏ —Ç.–¥.
dotenv.config();

// –°–æ–∑–¥–∞—ë–º Express –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
const app = express();

// –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–µ—Ä (–∏–∑ .env –∏–ª–∏ 5000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
const PORT = process.env.PORT || 5000;

// ======================================================


// ========== MIDDLEWARE (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û) ==========

// –í–∫–ª—é—á–∞–µ–º CORS ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (http://localhost:5173)
app.use(cors());

// –ü–∞—Ä—Å–∏–º JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (—á—Ç–æ–±—ã req.body —Ä–∞–±–æ—Ç–∞–ª)
app.use(express.json());

// –ü–∞—Ä—Å–∏–º URL-encoded –¥–∞–Ω–Ω—ã–µ (—Ñ–æ—Ä–º—ã)
app.use(express.urlencoded({ extended: true }));

// ======================================================


// ========== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ë–ê–ó–ï –î–ê–ù–ù–´–• ==========

// –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ MongoDB
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    // –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    console.log('‚úÖ MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∞');
  })
  .catch((err) => {
    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', err);
  });

// ======================================================


// ========== –†–û–£–¢–´ (–º–∞—Ä—à—Ä—É—Ç—ã) ==========

// –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ /api/auth –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –≤ —Ñ–∞–π–ª–µ auth.js
// –ù–∞–ø—Ä–∏–º–µ—Ä:
// POST /api/auth/register ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
// POST /api/auth/login ‚Üí –≤—Ö–æ–¥
// GET /api/auth/me ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
app.use('/api/auth', authRoutes);

// ======================================================


// ========== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–û–£–¢–´ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏) ==========

// –†–æ—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–µ—Ä
// –ó–∞–ø—Ä–æ—Å: GET http://localhost:5000/api/health
app.get('/api/health', (req, res) => {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º JSON –æ—Ç–≤–µ—Ç
  res.json({ 
    status: 'OK', 
    message: '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç' 
  });
});

// ======================================================


// ========== –û–ë–†–ê–ë–û–¢–ö–ê 404 (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞) ==========

// –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à—ë–ª –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ä–æ—É—Ç
app.use((req, res) => {
  res.status(404).json({ 
    message: '–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' 
  });
});

// ======================================================


// ========== –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ==========

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—Ç—É
app.listen(PORT, () => {
  console.log(`üöÄ –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${PORT}`);
});

// ======================================================